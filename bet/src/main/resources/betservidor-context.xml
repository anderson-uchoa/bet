<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<bean id="ControlValidadorServidor" class="lps.bet.basico.controlValidadorServidor.ControlValidadorServidor">
		<property name="interfaceRegistrarCorrida" ref="ControlarCorrida"/>
		<property name="interfaceProcessarViagem" ref="ControlarViagem"/>
		<property name="interfaceCartaoMgt" ref="CartaoMgr"/>
	</bean>

	<bean id="ControlarCorrida" class="lps.bet.basico.controlarCorrida.ControlarCorrida">
		<property name="interfaceAtualizarCorrida" ref="LinhaMgr"/>
	</bean>

	<bean id="ControlarViagem" class="lps.bet.basico.controlarViagem.ControlarViagem">
		<property name="interfaceRegistrarViagem" ref="CartaoMgr"/>
		<property name="interfaceCartaoMgt" ref="CartaoMgr"/>
		<property name="interfaceRegistrarArrecadacao" ref="LinhaMgr"/>
		<property name="interfaceLinhaMgt" ref="LinhaMgr"/>
		<property name="interfaceViacaoMgt" ref="ViacaoMgr"/>
	</bean>

	<bean id="AquisicaoCartao" class="lps.bet.basico.web.aquisicaoCartao.AquisicaoCartao">
		<property name="interfaceCartaoMgt" ref="CartaoMgr"/>
		<property name="ïnterfacePassageiroMgt" ref="PassageiroMgr"/>
	</bean>

	<bean id="CargaCartao" class="lps.bet.basico.web.cargaCartao.CargaCartao">
		<property name="interfaceCartaoMgt" ref="CartaoMgr"/>
	</bean>
	
	<bean id="CartaoMgr" class="lps.bet.basico.cartaoMgr.CartaoMgr">
		<property name="viagemDAO" ref="ViagemDAO"/>
		<property name="cartaoDAO" ref="CartaoDAO"/>
		<property name="tipoPassageiroDAO" ref="TipoPassageiroDAO"/>
		<property name="pagamentoDAO" ref="PagamentoDAO"/>
	</bean>

	<bean id="LinhaMgr" class="lps.bet.basico.linhaMgr.LinhaMgr">
		<property name="linhaDAO" ref="LinhaDAO"/>
		<property name="corridaDAO" ref="CorridaDAO"/>
		<property name="onibusDAO" ref="OnibusDAO"/>
	</bean>

	<!-- Como PassageiroMgr e FuncionarioMgr sao implementados pelos DAOS, eles ja foram colocados diretamente na parte dos DAOs-->
	
	<bean id="ViacaoMgr" class="lps.bet.basico.viacaoMgr.ViacaoMgr">
		<property name="empresaViariaDAO" ref="EmpresaViariaDAO"/>
		<property name="sistViarioUrbanoDAO" ref="SistViarioUrbanoDAO"/>
		<property name="tarifaDAO" ref="TarifaDAO"/>
	</bean>
	
	<!-- Beans relacionados ao Hibernate: dataSource e sessionFactory -->
	
	<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="url" value="jdbc:postgresql://localhost/BET"/>
		<property name="username" value="root"/>
		<property name="password" value="root"/>
		<property name="driverClassName" value="org.postgresql.Driver"/>
	</bean>
	
	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
	  <property name="dataSource" ref="dataSource"/>
	  <property name="mappingDirectoryLocations">
		<list>
			<value>file:C:/Documents and Settings/Paula/workspace/bet/src/main/resources/hibernate-mappings</value>
		</list>
	  </property>
	  <property name="hibernateProperties">
	    <props>
	      <prop key="hibernate.dialect">org.hibernate.dialect.PostgreSQLDialect</prop>
	    </props>
	  </property>
	</bean>
			
	
	<!-- DAOs do Servidor do sistema BET -->
	
	<bean id="LinhaDAO" class="lps.bet.basico.linhaMgr.LinhaDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="hqlBuscarLinhaCorrida">
			<value>
				<![CDATA[
				select linha1 
				    from Corrida as corrida join corrida.linha as linha1 
				    where corrida.corridaID = ? 
				]]>
			</value>
		</property>
	</bean>
	
	<bean id="CorridaDAO" class="lps.bet.basico.linhaMgr.CorridaDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="hqlBuscarCorridasPrevistas">
			<value>
				<![CDATA[
				select corrida 
					from Corrida as corrida 
					join corrida.onibus as onibus1
					where onibus1.onibusID = ? and 
						  corrida.saida = false and 
						  corrida.encerrado = false
					order by corrida.horaSaidaPrevista
				]]>
			</value>
		</property>
		<property name="hqlBuscarCorridaAtualOnibus">
			<value>
				<![CDATA[
				select corrida from Corrida as corrida join corrida.onibus as onibus1 
				where onibus1.onibusID = ? and corrida.saida = true and corrida.encerrado = false
				]]>
			</value>
		</property>
	</bean>
	
	<bean id="OnibusDAO" class="lps.bet.basico.linhaMgr.OnibusDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
	<bean id="ViagemDAO" class="lps.bet.basico.cartaoMgr.ViagemDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
	<bean id="CartaoDAO" class="lps.bet.basico.cartaoMgr.CartaoDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
	<bean id="TipoPassageiroDAO" class="lps.bet.basico.cartaoMgr.TipoPassageiroDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="hqlBuscarTipoPassagPorCartao">
			<value>
				<![CDATA[
				select tipo1 
				    from Cartao as cartao join cartao.tipoPassageiro as tipo1
				    where cartao.cartaoID = ? 
				]]>
			</value>
		</property>
		<property name="hqlBuscarTiposPermitidos">
			<value>
				<![CDATA[
				select tipo1 
				    from Cartao as cartao join cartao.tipoPassageiro as tipo1
				    where cartao.cartaoID = ? 
				]]>				
			</value>
		</property>
	</bean>
	
	<bean id="PagamentoDAO" class="lps.bet.basico.cartaoMgr.PagamentoDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
    <bean id="TarifaDAO" class="lps.bet.basico.viacaoMgr.TarifaDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="hqlBuscarTarifas">
			<value>
				<![CDATA[
				select tarifa 
				    from Tarifa as tarifa 
				order by tarifa.dtAtualizacao desc 
				]]>
			</value>
		</property> 
	</bean>
	
	<bean id="EmpresaViariaDAO" class="lps.bet.basico.viacaoMgr.EmpresaViariaDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
	<bean id="SistViarioUrbanoDAO" class="lps.bet.basico.viacaoMgr.SistViarioUrbanoDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	
	<bean id="PassageiroMgr" class="lps.bet.basico.passageiroMgr.PassageiroDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
		<property name="hqlBuscarPassageiroPorCPF">
			<value>
				<![CDATA[
				select passageiro 
				from Passageiro as passageiro
				where passageiro.cpf = ?
				]]>				
			</value>
		</property>
	</bean>
	
	<bean id="FuncionarioMgr" class="lps.bet.basico.funcionarioMgr.FuncionarioDAO">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>	
	
</beans>